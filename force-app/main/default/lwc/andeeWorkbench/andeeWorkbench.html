<template>

    <div data-id="mainDiv" class="slds-card-wrapper">

        
        <div class="spinner">
            <template if:true={isLoading}>
                <lightning-spinner alternative-text="Loading" variant="brand" size="large">
                </lightning-spinner>
            </template>
        </div>

        <br/>
        <div class="slds-media__body">

            <div class="slds-page-header slds-page-header_joined slds-page-header_bleed slds-shrink-none test-headerRegion slds-is-relative">
                <div class="slds-media slds-media--center slds-has-flexi-truncate">
                    <div class="slds-col slds-has-flexi-truncate firstHeaderRow">
                        <div class="slds-media slds-no-space slds-grow">
                            <h2 class="slds-card__header-title">
                                <span class="slds-truncate slds-m-right--xx-small" title="Workbench">
                                    Workbench 1.0.2
                                </span>
                            </h2>
                        </div>
                    </div>
                </div>
            </div>

            <template if:true={error}>
                <div data-id="errorDiv">
                    <div data-id="errorDivInner" class="slds-notify slds-notify--alert slds-theme--error slds-theme--alert-texture" role="alert" >
                    {error}
                    </div>
                </div>
            </template>

            <template if:false={isDisplaySingleId}>
                <div>

                    <table border="0" style="width: 100%;">
                        <tbody>
                            <tr>
                                <td valign="top" width="1" style="margin-top:2em;">
                                    Object:
                                    <select data-id="objectSelect" id="objectSelect" style="width: 16em" onchange={objectChanged}>
                                        <option value=''>--None--</option>
                                        <template for:each={objectOptions} for:item="oo" for:index="index">
                                            <option key={oo.index} value={oo.value}>{oo.label}</option>
                                        </template>
                                    </select>
                                </td>
                                <td>
                                    <table border="0" align="right" style="width:100%">
                                        <tbody>
                                            <tr>
                                                <td valign="top" colspan="2">&nbsp;
                                                </td>
                                                <td valign="top" colspan="2">
                                                    Deleted and archived records:<br>
                                                    <label>
                                                        <input type="radio" name="query_action" value="Query" checked>
                                                        Exclude
                                                    </label>&nbsp;
                                                    <label>
                                                        <input type="radio" name="query_action" data-id="excludeDeleted" value="QueryAll">
                                                        Include
                                                    </label>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td valign="top" width="1" style="margin-top:2em;">
                                    Fields:
                                    <select data-id="fieldSelect" id="fieldSelect" style="width: 16em;" multiple size="8" onchange={fieldChanged}>
                                        <option value='count()'>count()</option>
                                        <template for:each={fieldOptions} for:item="fo" for:index="index">
                                            <option key={fo.index} value={fo.value}>{fo.label}</option>
                                        </template>
                                    </select>
                                </td>
                                <td>
                                    <table id="QB_right_sub_table" border="0" align="right" style="width:100%">
                                        <tbody data-id="sort_and_filter">
                                            <tr id="sort_selection_headers">
                                                <td colspan="2">
                                                    <br>Sort results by:
                                                </td> 
                                                <td>
                                                    <br>Max Records:
                                                </td>
                                            </tr>
                                        
                                            <tr id="sort_selection_row">
                                                <td colspan="2">
                                                    <select data-id="QB_orderby_field" name="QB_orderby_field" style="width: 16em;" onchange={orderChanged}>
                                                        <option value=""></option>                                                
                                                        <template for:each={fieldOptions} for:item="fo" for:index="index">
                                                            <option key={fo.index} value={fo.value}>{fo.label}</option>
                                                        </template>
                                                    </select>
                                                    <select data-id="QB_orderby_sort" name="QB_orderby_sort" style="width: 6em;" onchange={orderChanged}>
                                                        <option value="ASC">A to Z</option>
                                                        <option value="DESC">Z to A</option>
                                                    </select>
                                                    <select data-id="QB_nulls" name="QB_nulls" style="width: 10em;" onchange={orderChanged}>
                                                        <option value="FIRST" selected="selected">Nulls First</option>
                                                        <option value="LAST">Nulls Last</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <input type="text" data-id="QB_limit_txt" size="10" name="QB_limit_txt" value={limit} onkeyup={limitChanged}>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <table data-id="filter_rows">
                                                        <tr>
                                                            <td colspan="4">
                                                                Filter results by:
                                                            </td>
                                                        </tr>

                                                        <tr data-id="filter-row-0">
                                                            <td colspan="4" valign="top" nowrap="true">
                                                                
                                                                <select data-id="QB_filter_field_0" name="QB_filter_field_0" style="width: 16em;" onchange={filterChanged}>
                                                                    <option value=""></option>                                                
                                                                    <template for:each={fieldWhereOptions} for:item="fo" for:index="index">
                                                                        <option key={fo.index} value={fo.value}>{fo.label}</option>
                                                                    </template>
                                                                </select>&nbsp;
                                                                <select data-id="QB_filter_compOper_0" name="QB_filter_compOper_0" style="width: 6em;" onchange={filterChanged}>
                                                                    <option value="=">=</option>
                                                                    <option value="!=">≠</option>
                                                                    <option value="<">&lt;</option>
                                                                    <option value="<=">≤</option>
                                                                    <option value=">">&gt;</option>
                                                                    <option value=">=">≥</option>
                                                                    <option value="starts">starts with</option>
                                                                    <option value="ends">ends with</option>
                                                                    <option value="contains">contains</option>
                                                                </select>
                                                                &nbsp;
                                                                <input type="text" data-id="QB_filter_value_0" size="27" name="QB_filter_value_0" value="" onkeyup={filterChanged}>
                                                            </td>
                                                        </tr>

                                                        <tr data-id="filter-row-1">
                                                            <td colspan="4" valign="top" nowrap="true">
                                                                
                                                                <select data-id="QB_filter_field_1" name="QB_filter_field_1" style="width: 16em;" onchange={filterChanged}>
                                                                    <option value=""></option>                                                
                                                                    <template for:each={fieldWhereOptions} for:item="fo" for:index="index">
                                                                        <option key={fo.index} value={fo.value}>{fo.label}</option>
                                                                    </template>
                                                                </select>&nbsp;
                                                                <select data-id="QB_filter_compOper_1" name="QB_filter_compOper_1" style="width: 6em;" onchange={filterChanged}>
                                                                    <option value="=">=</option>
                                                                    <option value="!=">≠</option>
                                                                    <option value="<">&lt;</option>
                                                                    <option value="<=">≤</option>
                                                                    <option value=">">&gt;</option>
                                                                    <option value=">=">≥</option>
                                                                    <option value="starts">starts with</option>
                                                                    <option value="ends">ends with</option>
                                                                    <option value="contains">contains</option>
                                                                </select>
                                                                &nbsp;
                                                                <input type="text" data-id="QB_filter_value_1" size="27" name="QB_filter_value_1" value="" onkeyup={filterChanged}>
                                                            </td>
                                                        </tr>

                                                        

                                                        <tr data-id="filter-row-2">
                                                            <td colspan="4" valign="top" nowrap="true">
                                                                
                                                                <select data-id="QB_filter_field_2" name="QB_filter_field_2" style="width: 16em;" onchange={filterChanged}>
                                                                    <option value=""></option>                                                
                                                                    <template for:each={fieldWhereOptions} for:item="fo" for:index="index">
                                                                        <option key={fo.index} value={fo.value}>{fo.label}</option>
                                                                    </template>
                                                                </select>&nbsp;
                                                                <select data-id="QB_filter_compOper_2" name="QB_filter_compOper_2" style="width: 6em;" onchange={filterChanged}>
                                                                    <option value="=">=</option>
                                                                    <option value="!=">≠</option>
                                                                    <option value="<">&lt;</option>
                                                                    <option value="<=">≤</option>
                                                                    <option value=">">&gt;</option>
                                                                    <option value=">=">≥</option>
                                                                    <option value="starts">starts with</option>
                                                                    <option value="ends">ends with</option>
                                                                    <option value="contains">contains</option>
                                                                </select>
                                                                &nbsp;
                                                                <input type="text" data-id="QB_filter_value_2" size="27" name="QB_filter_value_2" value="" onkeyup={filterChanged}>
                                                            </td>
                                                        </tr>

                                                        <tr data-id="filter-row-3">
                                                            <td colspan="4" valign="top" nowrap="true">
                                                                
                                                                <select data-id="QB_filter_field_3" name="QB_filter_field_3" style="width: 16em;" onchange={filterChanged}>
                                                                    <option value=""></option>                                                
                                                                    <template for:each={fieldWhereOptions} for:item="fo" for:index="index">
                                                                        <option key={fo.index} value={fo.value}>{fo.label}</option>
                                                                    </template>
                                                                </select>&nbsp;
                                                                <select data-id="QB_filter_compOper_3" name="QB_filter_compOper_3" style="width: 6em;" onchange={filterChanged}>
                                                                    <option value="=">=</option>
                                                                    <option value="!=">≠</option>
                                                                    <option value="<">&lt;</option>
                                                                    <option value="<=">≤</option>
                                                                    <option value=">">&gt;</option>
                                                                    <option value=">=">≥</option>
                                                                    <option value="starts">starts with</option>
                                                                    <option value="ends">ends with</option>
                                                                    <option value="contains">contains</option>
                                                                </select>
                                                                &nbsp;
                                                                <input type="text" data-id="QB_filter_value_3" size="27" name="QB_filter_value_3" value="" onkeyup={filterChanged}>
                                                            </td>
                                                        </tr>


                                                    </table>
                                                </td>
                                                <!--<td id="filter_plus_cell" valign="bottom">
                                                    <lightning-icon icon-name='action:new' alternative-text='new' size='xx-small' title='new' onclick={addFilterRow}></lightning-icon>
                                                </td>-->
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>

                            <tr>
                                <td valign="top" colspan="2">
                                    <br>Enter or modify a SOQL query below:
                                    <br>
                                    <textarea data-id="soql_query_textarea" type="text" name="soql_query" rows="5" style="width: 99%; overflow: auto; font-family: monospace, courier;">
                                        {soqlQuery}
                                    </textarea>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="1">
                                    <table>
                                        <tr>
                                            <td>
                                                <input type="submit" name="querySubmit" value="Query" onclick={submitQuery}>
                                            </td>
                                            <td>
                                                <input type="submit" name="querySubmit" value="TSV" onclick={submitTsvQuery}>
                                            </td>
                                            <td>
                                                <input type="submit" name="querySubmit" value="Batch TSV" onclick={submitQueryBatch}>
                                            </td>
                                        </tr>
                                    </table>                            
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="clear: both;">
                    <br>
                    <template if:true={queryResults}>
                        <table id="query_results" class="dataTable">
                            <tbody>
                                <tr>
                                    <template for:each={queryHeadings} for:item="qh" for:index="index">
                                        <th key={qh.index}>{qh}</th>
                                    </template>
                                </tr>
                                <template for:each={queryResults} for:item="record">
                                    <tr key={record.RowId}>
                                    <template for:each={record.Fields} for:item="field">
                                        <td key={field.Name}>
                                            <template if:true={field.Linkable}>
                                                <template if:false={field.IsDownloadLink}>
                                                    <a data-id={field.Value} onclick={displaySingleRow}>{field.Value}</a>
                                                </template>
                                                <template if:true={field.IsDownloadLink}>
                                                    <a href={field.HRef} target="_blank">{field.Value}</a>
                                                </template>
                                            </template>
                                            <template if:false={field.Linkable}>
                                                {field.Value}
                                            </template>
                                        </td>
                                    </template>
                                    </tr>
                                </template>
        
                            </tbody>
                        </table>
                    </template>
        
                    <template if:true={jobStatus}>
                        <p>Status: {jobStatus.Status}</p>
                        <p>Items Processed: {jobStatus.JobItemsProcessed} / {jobStatus.TotalJobItems}</p>
                        
                        <template if:true={isBatchJobCompleted}>
                            <p><a href={contentVersionUrl} target="_blank">Download</a></p>
                        </template>
                    </template>
                </div>


            </template>

            

            <template if:true={isDisplaySingleId}>
                Single Id Display : {selectedSingleRecordId} for Object : {selectedSingleRecordObject}

                <p>
                    <input type="submit" name="back" value="Back" onclick={displayQueryView}>
                    <input type="submit" name="update" value="Update" onclick={updateView}>
                </p>

                <table id="single_row_results" class="dataTable">
                    <tbody>
                        <template for:each={rowData} for:item="record">
                            <template if:false={isUpdateView}>
                                <tr key={record.Name}>
                                    <td>
                                        {record.Name}
                                    </td>
                                    
                                    <td>
                                        <template if:true={record.Linkable}>
                                            <a data-id={record.Value} onclick={displaySingleRow}>{record.Value}</a>
                                        </template>
                                        <template if:false={record.Linkable}>
                                            {record.Value}
                                        </template>
                                    </td>
                                </tr>
                            </template>
                                
                            <template if:true={isUpdateView}>
                                <template if:true={record.Updatable}>
                                    <tr key={record.Name}>
                                        <td>
                                            {record.Name}
                                        </td>
                                        <td>
                                            <input type="text" data-id="updateField" size="30" name="updateField" data-fieldname={record.Name} value={record.Value}/>
                                        </td>
                                    </tr>
                                </template>
                            </template>
                        </template>

                    </tbody>
                </table>


                <p>
                    <input type="submit" name="back" value="Back" onclick={displayQueryView}>
                    <input type="submit" name="update" value="Update" onclick={updateView}>
                </p>
            </template>


        </div>


        

    </div>
    
</template>
